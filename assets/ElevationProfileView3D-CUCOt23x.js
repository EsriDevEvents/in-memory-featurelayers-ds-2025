import{g8 as y,d6 as _,cD as E,X as $,o as a,lI as D,ga as b,j as c,y as f,P as R,b_ as H,ev as l,mb as L,db as P,bL as T,m1 as k,hM as u}from"./index-Dv-JqQDv.js";import{r as O,t as v}from"./ElevationProfile-CrCq1vB9.js";import{a as S}from"./HoveredPoints-z9hw_vKi.js";import{a as V}from"./elevationInfoUtils-Cey9W7Lb.js";import{j as I}from"./settings-DkK6htAH.js";import{w}from"./OutlineVisualElement-Be8-V1zz.js";import{e as M}from"./GraphicState-CQOGEKxf.js";import{h as z}from"./debugFlags-CfrzpJ7g.js";import{n as G}from"./layerViewUtils-D2JqIDZ8.js";import{e as j}from"./throttle-jjSnxk80.js";import"./memoize-DsJmrG76.js";import"./jsxFactory-C3RLkrq9.js";import"./ByteSizeUnit-BsxeN7wM.js";import"./ElevationQueryTileCache-BJ_8u3U9.js";import"./projectVectorToVector-BbXjU1Ty.js";import"./projectPointToVector-ARkh6gdu.js";import"./LayerConstants-B33OP6sh.js";import"./ElevationProvider-DZcTQ1wD.js";import"./mat4f64-Dk4dwAN8.js";import"./sphere-j1PWtIhy.js";import"./plane-4BN6ZBDV.js";import"./mat3f64-BBpwCtoL.js";import"./quatf64-BrpT0VRp.js";import"./vec2f64-Diu2Kaa8.js";import"./mathUtils-urfecwwD.js";import"./ViewingMode-Dodu7ZZk.js";import"./boundedPlane-DBcMJiAN.js";import"./lineSegment-C_r0Slta.js";import"./verticalOffsetUtils-DVynISE7.js";import"./mat3-B7LiNcRs.js";import"./orientedBoundingBox-BiAE_4Zn.js";import"./quat-B52zwwOM.js";import"./spatialReferenceEllipsoidUtils-MFgRhPLs.js";import"./computeTranslationToOriginAndRotation-DBznw1xD.js";import"./Intersector-BLO31d1u.js";import"./Intersector-TO0eVp6c.js";import"./defaultUnit-DR4mV0yv.js";import"./getDefaultUnitForView-CsWpEOAw.js";import"./vec2-DGogPjh1.js";import"./geodesicUtils-C4H45CeC.js";import"./QueueProcessor-DHxW4yaI.js";import"./ReactiveMap-DxvIcNmk.js";import"./signal-0tlktF45.js";import"./Scheduler-KZBBWfDI.js";import"./debugFlags-CVnXAL57.js";import"./traversalUtils-DmE6QkgJ.js";import"./Ground-DpNOewuO.js";import"./ElevationQuery-DdsadaEp.js";import"./ElevationSamplerData-CTsi29Ag.js";import"./ElevationTile-z5FKMbqq.js";import"./TileKey-DZd6gJy7.js";import"./GraphicsLayer-D1PdSLqE.js";import"./GraphicsCollection-DlcRCtU0.js";import"./InputManager-BwD1PEf3.js";import"./SketchViewModel-RO1Mu5ze.js";import"./isSupportedObject-CXGhKfYW.js";import"./SketchLabelOptions-DrqnZvLd.js";import"./SnappingManager-BxBCA2Ex.js";import"./UpdatingHandles-C0Kh7aEt.js";import"./geometry2dUtils-BOZAHPKg.js";import"./floorFilterUtils-DZ5C6FQv.js";import"./keybindings-DX6sI0di.js";import"./utils-CXgSw6Sd.js";import"./geodesicLengthMeasurementUtils-BLtZnsPD.js";import"./quantityUtils-CvTt11a2.js";import"./geometryEngine-C5uHQPwZ.js";import"./geometryEngineBase-RmbNeFm7.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./hydrated-iwj77qVb.js";import"./Cyclical-L5YKfO29.js";import"./layerUtils-BS1Di3Pm.js";import"./hitTestSelectUtils-UXJPjatw.js";import"./screenUtils-DKZWDFXK.js";import"./unitFormatUtils-D-q5OaJY.js";import"./substitute-BVUBXY1A.js";import"./UnitSelect-C-nWBhb5.js";import"./globalCss-CZa70j6i.js";import"./AnchorElementViewModel-C0T6vNtn.js";import"./ExtendedLineVisualElement-B0T34MD8.js";import"./vec4f32-CjrfB-0a.js";import"./frustum-W7EQ25hI.js";import"./EngineVisualElement-DfSprzSD.js";import"./RenderGeometry-D3-u-2b6.js";import"./vec3f32-Cw9Q6TO_.js";import"./DoubleArray-DzYWDmvK.js";import"./DefaultTechniqueConfiguration-C28-5KBi.js";import"./Indices-BTetzIKW.js";import"./basicInterfaces-wONHx_SN.js";import"./Util-CQaYQWOS.js";import"./triangle-0a93pGd5.js";import"./VertexAttribute-BnAa5VW0.js";import"./doublePrecisionUtils-B0owpBza.js";import"./requestImageUtils-CO_Ks2k6.js";import"./enums-BlUEVwJR.js";import"./Texture-BsiXXqc8.js";import"./renderState-yUi34s5A.js";import"./Matrix4PassUniform-B-NXMru_.js";import"./interfaces-B8ge7Jg9.js";import"./BindType-BmZEZMMh.js";import"./ShaderTechniqueConfiguration-D3UbJ2mX.js";import"./hydratedFeatures-D9SfIMrp.js";import"./axisAngleDegrees-CRhw0Lf9.js";import"./weather-K8rA5AE9.js";import"./Float4DrawUniform-DDO6IFxX.js";import"./NestedMap-DgiGbX8E.js";import"./Octree-BaSixQu1.js";import"./InterleavedLayout-B5L5JJLV.js";import"./BufferView-_0HdWB6j.js";import"./types-D0PSWh4d.js";import"./floatRGBA-BTfDfCN4.js";import"./glUtil-C6KhMg1m.js";import"./VertexElementDescriptor-BOD-G50G.js";import"./VertexArrayObject-Czm05pt7.js";import"./BufferObject-Dhco7AlX.js";import"./VisualElement-C7QPSfUA.js";import"./Laserlines.glsl-Dxbyjke2.js";import"./lineStippleUtils-BesjtKyl.js";import"./triangulationUtils-BhDjnI5P.js";import"./earcut-BqgeR2O3.js";import"./deduplicate-DQWVMiBh.js";let x=class{constructor(t){this._params=t,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null,this._settings=new I({getTheme:()=>this._params.view.effectiveTheme})}destroy(){this.remove()}remove(){this._highlightTask=y(this._highlightTask),this._highlightHandle=_(this._highlightHandle),this._visualElementHandle=_(this._visualElementHandle)}showHighlight(t){if(this.remove(),t==null||!g(t))return;const e=t.layer;this._highlightTask=E(async i=>{const s=await this._params.view.whenLayerView(e);$(i),G(s)&&(this._highlightHandle=s.highlight(t))})}showReshaping(t){if(this.remove(),t==null)return;const e=this._params.view,i=new w({view:e,geometry:g(t)?t.geometry:null,attached:!1,elevationInfo:V(t),renderOccluded:z.OccludeAndTransparentStencil,isDecoration:!0}),s=new M({graphic:t}),o=[a(()=>s.isDraped,m=>{i.isDraped=m}),s.on("changed",()=>{i.geometry=g(t)?t.geometry:null}),e.trackGraphicState(s),e.maskOccludee(t),D(i)];this._settings.visualElements.lineObjects.outline.apply(i),i.attached=!0,this._visualElementHandle=b(o)}};function g(r){return r.geometry!=null&&r.geometry.type==="polyline"}const A=100;let h=class extends H{constructor(r){super(r),this._chartData=null,this._visualElements=[]}initialize(){const r=j(t=>{this._update(t)},A);this.addHandles([a(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),r,l),r])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(r){this._chartData=r}_update(r){const{chartData:t}=r;if(t==null)return this.remove();if(!t.refined)return;const e=this._visualElements,i=t.lines.filter(p=>p.viewVisualizationEnabled),s=i.length;for(;e.length>s;)e.pop().destroy();const o=O().profileLinesStyle3D;for(;e.length<s;){const p=new w({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:o.width-o.outlineSize,width:o.width,falloff:o.falloff,color:o.outlineColor,renderOccluded:o.renderOccluded,isDecoration:!0});e.push(p)}const m=r.spatialReference;for(let p=0;p<s;++p){const d=e[p],n=i[s-1-p];d.geometry=this._createLineGeometry(n,m),d.innerColor=L(P.toUnitRGBA(n.color))}}_createLineGeometry(r,t){const e=r.samples??[],i=e.length-1,s=[];let o=[];for(let m=0;m<=i;m++){const{x:p,y:d,z:n}=e[m];n!=null&&o.push([p,d,n]),m!==i&&n!=null||!o.length||(s.push(o),o=[])}return new T({paths:s,hasZ:!0,spatialReference:t})}_destroyVisualElements(){this._visualElements.forEach(r=>r.destroy()),this._visualElements.length=0}};c([f()],h.prototype,"view",void 0),c([f()],h.prototype,"_chartData",void 0),h=c([R("esri.widgets.ElevationProfile.support.ProfileLines3D")],h);class te{constructor(t,e){this._handles=new k,this._inputRepresentation=new x({view:t}),this._hoveredPoints=new S({view:t}),this._profileLines=new h({view:t}),this._handles.add([a(()=>e.viewModel.hoveredPoints,i=>this._hoveredPoints.update(i),l),a(()=>{const{state:i,editable:s,highlightEnabled:o,viewModel:m}=e,p=m.input;return p&&(p.commitProperty("geometry"),p.commitProperty("layer")),{input:p,state:i,editable:s,highlightEnabled:o}},i=>this._updateInputRepresentation(i),l),a(()=>e.viewModel.chartData,i=>this._profileLines.update(i),l),a(()=>{var i;return(i=e.viewModel.input)==null?void 0:i.geometry},()=>{this._profileLines.remove()},l)])}destroy(){this._handles=u(this._handles),this._inputRepresentation=u(this._inputRepresentation),this._hoveredPoints=u(this._hoveredPoints),this._profileLines=u(this._profileLines)}_updateInputRepresentation({input:t,state:e,editable:i,highlightEnabled:s}){const o=this._inputRepresentation;if(!s)return o.remove();e===v.Selected?o.showHighlight(t):e!==v.Created||i?o.remove():o.showReshaping(t)}}export{te as ElevationProfileView3D};
