import{m as M}from"./Viewpoint-kowK2Ox4.js";import{cR as L,dG as it,Q as P,x as Q,fx as W,dD as C,a0 as D,a2 as E,dE as J,fy as O,dH as st,J as ct,aR as ut,ar as ft,fz as lt,dF as T,fA as yt}from"./index-Dv-JqQDv.js";import{f as mt,s as _,c as H,i as v,M as pt,h as gt,u as xt}from"./mat2d-C6u6dH6d.js";import{e as S}from"./mat2df64-CBKYtunK.js";import{x as ht,l as $,o as y,e as q,v as I,y as bt,j as wt,q as V,B as K,S as j,r as dt,u as Gt}from"./vec2-DGogPjh1.js";import{r as Rt,n as l}from"./vec2f64-Diu2Kaa8.js";const X=96,Y=39.37,At=180/Math.PI;function Z(t){return t.wkid?t:t.spatialReference||ct.WGS84}function F(t,e){return e.type?y(t,e.x,e.y):dt(t,e)}function U(t){return it(t)}function tt(t,e,n=0){let r=t.width,o=t.height;if(n!==0){const u=ut(n),c=Math.abs(Math.cos(u)),s=Math.abs(Math.sin(u));r=t.width*c+t.height*s,o=t.width*s+t.height*c}const a=Math.max(1,e[0]),i=Math.max(1,e[1]);return Math.max(r/a,o/i)*jt(t.spatialReference)}async function A(t,e,n,r){var u,c;let o,a;if(!t||Array.isArray(t)&&!t.length)return null;if(ft.isCollection(t)&&(t=t.toArray()),Array.isArray(t)&&t.length&&typeof t[0]=="object"){const s=t.every(f=>"attributes"in f),p=t.some(f=>!f.geometry);let m=t;if(s&&p&&e&&e.allLayerViews){const f=new Map;for(const g of t){const b=g.layer,R=f.get(b)||[],d=g.attributes[b.objectIdField];d!=null&&R.push(d),f.set(b,R)}const x=[];f.forEach((g,b)=>{const R=e.allLayerViews.find(d=>d.layer.id===b.id);if(R&&"queryFeatures"in R){const d=b.createQuery();d.objectIds=g,d.returnGeometry=!0,x.push(R.queryFeatures(d))}});const h=await Promise.all(x),w=[];for(const g of h)if(g&&g.features&&g.features.length)for(const b of g.features)b.geometry!=null&&w.push(b.geometry);m=w}for(const f of m)r=await A(f,e,n,r);return r}if(Array.isArray(t)&&t.length===2&&typeof t[0]=="number"&&typeof t[1]=="number")o=new P(t);else if(t instanceof W)o=t;else if("geometry"in t){if(t.geometry)o=t.geometry;else if(t.layer){const s=t.layer,p=e.allLayerViews.find(m=>m.layer.id===s.id);if(p&&"queryFeatures"in p){const m=s.createQuery();m.objectIds=[t.attributes[s.objectIdField]],m.returnGeometry=!0;const f=await p.queryFeatures(m);o=(c=(u=f==null?void 0:f.features)==null?void 0:u[0])==null?void 0:c.geometry}}}if(o==null)return null;switch(o.type){case"point":a=new Q({xmin:o.x,ymin:o.y,xmax:o.x,ymax:o.y,spatialReference:o.spatialReference});break;case"extent":case"multipoint":case"polygon":case"polyline":a=lt(o);break;default:a=o.extent}if(!a)return null;C()||E(a.spatialReference,n)||await J();const i=T(a,n);if(!i)return null;if(r){const s=i.center,p=s.clone();p.x=O(s.x,r.center.x,n),p.x!==s.x&&i.centerAt(p),r=r.union(i)}else r=i;return r}function kt(t){var e;if(t&&(!Array.isArray(t)||typeof t[0]!="number")&&(typeof t=="object"||Array.isArray(t)&&typeof t[0]=="object")){if("layer"in t&&((e=t.layer)==null?void 0:e.minScale)!=null&&t.layer.maxScale!=null){const n=t.layer;return{min:n.minScale,max:n.maxScale}}if(Array.isArray(t)&&t.length&&t.every(n=>"layer"in n)){let n=0,r=0;for(const o of t){const a=o.layer;a!=null&&a.minScale&&a.maxScale&&(n=a.minScale<n?a.minScale:n,r=a.maxScale>r?a.maxScale:r)}return n&&r?{min:n,max:r}:null}}}function B(t,e){return D(Z(t),e)?t:T(t,e)}async function Ct(t,e){var g;if(!t||!e)return new M({targetGeometry:new P,scale:0,rotation:0});let n=e.spatialReference;const{constraints:r,padding:o,viewpoint:a,size:i}=e,u=[o?i[0]-o.left-o.right:i[0],o?i[1]-o.top-o.bottom:i[1]];let c=null;t instanceof M?c=t:t.viewpoint?c=t.viewpoint:t.target&&t.target.declaredClass==="esri.Viewpoint"&&(c=t.target);let s=null;c!=null&&c.targetGeometry?s=c.targetGeometry:t instanceof Q?s=t:t instanceof W?s=await A(t,e,n):t&&(s=await A(t.center,e,n)||await A(t.target,e,n)||await A(t,e,n)),!s&&(a!=null&&a.targetGeometry)?s=a.targetGeometry:!s&&e.extent&&(s=e.extent),n||(n=Z(e.spatialReference||e.extent||s)),C()||D(s.spatialReference,n)||E(s.spatialReference,n)||await J();const p=B(s,n),m="center"in p?p.center:p;e.pickClosestTarget!==!1&&m.type==="point"&&((g=a.targetGeometry)==null?void 0:g.type)==="point"&&(m.x=O(m.x,a.targetGeometry.x,m.spatialReference));let f=0;c?f=c.rotation:t.hasOwnProperty("rotation")?f=t.rotation:a&&(f=a.rotation);let x=0;x=(c==null?void 0:c.targetGeometry)!=null&&c.targetGeometry.type==="point"?c.scale:"scale"in t&&t.scale?t.scale:"zoom"in t&&t.zoom!==-1&&r&&r.effectiveLODs?r.zoomToScale(t.zoom):Array.isArray(s)||s.type==="point"||s.type==="extent"&&s.width===0&&s.height===0?a.scale:tt(B(s.extent,n),u,f);const h=kt(t.target??t);h&&(h.min&&h.min<x?x=h.min:h.max&&h.max>x&&(x=h.max));let w=new M({targetGeometry:m,scale:x,rotation:f});return r&&(w=r.fit(w),r.constrainByGeometry(w),r.rotationEnabled||(w.rotation=a.rotation)),w}function G(t,e){const n=t.targetGeometry,r=e.targetGeometry;return n.x=r.x,n.y=r.y,n.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}function St(t,e,n){return n?y(t,.5*(e[0]-n.right+n.left),.5*(e[1]-n.bottom+n.top)):$(t,e,.5)}const Dt=function(){const t=l();return function(e,n,r){const o=n.targetGeometry;F(t,o);const a=.5*k(n);return e.xmin=t[0]-a*r[0],e.ymin=t[1]-a*r[1],e.xmax=t[0]+a*r[0],e.ymax=t[1]+a*r[1],e.spatialReference=o.spatialReference,e}}();function Et(t,e,n,r,o){var a;return zt(t,e,n.center),t.scale=tt(n,r),(a=o==null?void 0:o.constraints)==null||a.constrain(t),t}function $t(t,e,n,r){return rt(t,e,n,r),xt(t,t)}const et=function(){const t=l();return function(e,n,r){return K(e,Ft(e,n),St(t,n,r))}}(),Mt=function(){const t=S(),e=l();return function(n,r,o,a){const i=k(r),u=N(r);return y(e,i,i),gt(t,e),_(t,t,u),v(t,t,et(e,o,a)),v(t,t,[0,a.top-a.bottom]),y(n,t[4],t[5])}}();function k(t){var e;return t.scale*vt((e=t.targetGeometry)==null?void 0:e.spatialReference)}function vt(t){return t!=null&&L(t)?1/(U(t)*Y*X):1}function N(t){return yt(t.rotation)||0}function jt(t){return L(t)?U(t)*Y*X:1}function Ft(t,e){return $(t,e,.5)}const nt=function(){const t=l(),e=l(),n=l();return function(r,o,a,i,u,c){return ht(t,o),$(e,a,.5*c),y(n,1/i*c,-1/i*c),mt(r,e),u&&_(r,r,u),H(r,r,n),v(r,r,t),r}}(),rt=function(){const t=l();return function(e,n,r,o){const a=k(n),i=N(n);return F(t,n.targetGeometry),nt(e,t,r,a,i,o)}}(),Jt=function(){const t=l();return function(e,n,r,o){const a=k(n);return F(t,n.targetGeometry),nt(e,t,r,a,0,o)}}();function Nt(t){const e=st(t);return e?e.valid[1]-e.valid[0]:0}function Ot(t,e){return Math.round(Nt(t)/e)}const Tt=function(){const t=l(),e=l(),n=[0,0,0];return function(r,o,a){q(t,r,o),I(t,t),q(e,r,a),I(e,e),bt(n,t,e);let i=Math.acos(wt(t,e)/(V(t)*V(e)))*At;return n[2]<0&&(i=-i),isNaN(i)&&(i=0),i}}(),_t=function(){const t=l();return function(e,n,r,o){const a=e.targetGeometry;return G(e,n),Mt(t,n,r,o),a.x+=t[0],a.y+=t[1],e}}(),zt=function(t,e,n){G(t,e);const r=t.targetGeometry;return r.x=n.x,r.y=n.y,r.spatialReference=n.spatialReference,t},Ht=function(){const t=l();return function(e,n,r,o,a){a||(a="center"),K(t,r,o),$(t,t,.5);const i=t[0],u=t[1];switch(a){case"center":y(t,0,0);break;case"left":y(t,-i,0);break;case"top":y(t,0,u);break;case"right":y(t,i,0);break;case"bottom":y(t,0,-u);break;case"top-left":y(t,-i,u);break;case"bottom-left":y(t,-i,-u);break;case"top-right":y(t,i,u);break;case"bottom-right":y(t,i,-u)}return z(e,n,t),e}}();function Kt(t,e,n){return G(t,e),t.rotation+=n,t}function Xt(t,e,n){return G(t,e),t.rotation=n,t}const qt=function(){const t=l();return function(e,n,r,o,a){return G(e,n),isNaN(r)||r===0||(at(t,o,n,a),e.scale=n.scale*r,ot(t,t,e,a),z(e,e,y(t,t[0]-o[0],o[1]-t[1]))),e}}();function Yt(t,e,n){return G(t,e),t.scale=n,t}const It=function(){const t=l();return function(e,n,r,o,a,i){return G(e,n),isNaN(r)||r===0||(at(t,a,n,i),e.scale=n.scale*r,e.rotation+=o,ot(t,t,e,i),z(e,e,y(t,t[0]-a[0],a[1]-t[1]))),e}}(),Zt=function(){const t=l(),e=l();return function(n,r,o,a,i,u,c){return et(e,u,c),Gt(t,i,e),a?It(n,r,o,a,t,u):qt(n,r,o,t,u)}}(),at=function(){const t=S();return function(e,n,r,o){return j(e,n,$t(t,r,o,1))}}(),ot=function(){const t=S();return function(e,n,r,o){return j(e,n,rt(t,r,o,1))}}(),z=function(){const t=l(),e=S();return function(n,r,o){G(n,r);const a=k(r),i=n.targetGeometry;return pt(e,N(r)),H(e,e,Rt(a,a)),j(t,o,e),i.x+=t[0],i.y+=t[1],n}}();export{St as $,It as G,tt as H,Zt as R,Ct as Y,G as Z,Dt as _,vt as a,Kt as b,jt as c,Jt as f,_t as g,Ht as h,Yt as j,z as k,rt as l,Nt as m,k as o,Tt as p,et as r,Et as t,nt as u,Xt as w,zt as x,Ot as y};
