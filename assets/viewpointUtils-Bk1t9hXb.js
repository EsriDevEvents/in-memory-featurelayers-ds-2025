import{d as ne,m as Ge}from"./Viewpoint-kowK2Ox4.js";import{a0 as Xe,cq as Qn,fL as Ye,cr as et,J,pS as nt,aN as O,dP as rn,dA as R,ca as le,dz as Z,fN as Oe,aI as G,dB as _,ad as d,aL as te,aJ as L,aT as E,dy as Ve,pT as tt,aR as b,ni as at,cb as ue,x as Ee,af as ye,fH as it,pU as rt,c6 as ot,fO as De,gy as st,Q as h,ag as ct,dF as on,pV as lt,G as ut,X as T,jS as j,fE as He,bc as ft,bQ as mt,cj as sn,s as cn,pW as dt,pX as pt,pY as gt,o1 as ht,pZ as yt,fx as wt,a6 as xt,cU as ln,bM as vt,e$ as Ce,gL as Qe,eS as Mt,dx as x,c4 as Rt,p_ as bt,p$ as Tt,q0 as St}from"./index-Dv-JqQDv.js";import{n as Ie,r as $t,a as un}from"./Cyclical-L5YKfO29.js";import{n as zt,u as Gt}from"./mat3-B7LiNcRs.js";import{e as Ct}from"./mat3f64-BBpwCtoL.js";import{e as Fe}from"./mat4f64-Dk4dwAN8.js";import{u as At}from"./computeTranslationToOriginAndRotation-DBznw1xD.js";import{c as fe,i as me}from"./projectPointToVector-ARkh6gdu.js";import{t as ae,c as fn}from"./projectVectorToPoint-D_lHmELE.js";import{n as B}from"./projectVectorToVector-BbXjU1Ty.js";import{l as Pt}from"./frustum-W7EQ25hI.js";import{T as Ot,b as we}from"./ElevationProvider-DZcTQ1wD.js";import{l as Et,f as Dt}from"./spatialReferenceEllipsoidUtils-MFgRhPLs.js";import{l as Ue}from"./ViewingMode-Dodu7ZZk.js";import{l as Ht,s as It}from"./earthUtils-D6ZAndqJ.js";import{r as Ft}from"./spatialReferenceSupport-hDa_4tCr.js";function Ut(e){return Xe(e,Et)||Qn(e)?{wkid:Ye.GCSMARS2000}:Xe(e,Dt)||et(e)?{wkid:Ye.GCSMOON2000}:J.WGS84}function ni(e,n,t,i){return e.renderCoordsHelper.fromRenderCoords(n.eye,de,i)!=null&&nt(t,de)}function _t(e,n){return e.elevationProvider?e.elevationProvider.getElevation(n[0],n[1],n[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function N(e,n,t,i){const a=e.state.camera.clone();n&&t&&i&&(a.eye=n,a.center=t,a.up=i),Lt(e,a.ray,A)||O(A,a.center);const r=e.state.constraints,o=r.minimumPoiDistance;if(rn(a.eye,A)<o){const s=r.collision.enabled;O(F,a.viewForward),R(F,F,o),s?a.eye=le(de,A,F):Z(A,a.eye,F);const c=e.renderCoordsHelper,l=c.getAltitude(a.eye),u=r.collision.elevationMargin;s&&l<u&&(le(F,A,a.eye),a.eye=c.setAltitude(de,u,a.eye),Z(A,a.eye,F))}return a.center=A,a}function en(e,n,t){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const i=_t(e,n),a=e.stateManager.constraintsManager.nearFarHeuristic,{far:r}=a.compute(n,t,e.renderDataExtent,i,kt),o=r*r;return rn(n,t)>o}function Lt(e,n,t){let i=nn[e.viewingMode];i||(i=Ot(e.state.viewingMode),i.options.backfacesTerrain=!e.state.isGlobal,i.options.invisibleTerrain=!0,nn[e.viewingMode]=i);const{isGlobal:a}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(n,i,t)||en(e,n.origin,t))||!(!e.renderCoordsHelper.intersectManifold(n,0,t)||en(e,n.origin,t))||!!a&&jt(n,t,Oe(e.spatialReference).radius)}function jt(e,n,t){const i=G(e.origin,e.origin)-t*t,a=i>0?Math.sqrt(i)/3:1;return R(n,e.direction,a/_(e.direction)),Z(n,n,e.origin),!0}const nn={},de=d(),A=d(),F=d(),kt={near:0,far:0},qt=d(),re=d();function mn(){return{direction:d(),up:d()}}function dn(e,n,t,i,a){let r=te(qt,e),o=G(r,i);const s=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(G(n,i)),o<.99?(O(r,n),s&&R(r,r,-1)):r=null);let c=0;if(r){R(re,i,G(i,r)),le(r,r,re);const u=G(r,a)/(_(r)*_(a));L(re,r,a),c=(G(re,i)>0?1:-1)*E(Ve(u))}const l=E(Ve(-G(i,e)/_(e)));return t?(t.heading=c,t.tilt=l,t):{heading:c,tilt:l}}const pn=ye(0,1,0),gn=ye(0,0,1),Y=Fe(),$=d(),z=d();function hn(e,n,t,i=mn()){const{direction:a,up:r}=i;return tt(Y,-b(n)),at(Y,Y,b(t)),ue(a,gn,Y),R(a,a,-1),ue(r,pn,Y),i}function Zt(e,n,t,i){return dn(n,t,i,gn,pn)}function Bt(e,n,t,i){const a=hn(e,t,i),r=d();return R(r,a.direction,-n),Z(r,r,e),{up:a.up,eye:r,heading:t,tilt:i}}function Wt(e){return E(e)}function Jt(e){return b(e)}function yn(e,n,t,i,a){const r=e.renderSpatialReference,o=e.map&&e.spatialReference||n.spatialReference;return fe(n,$,r),fe(n,z,r),$[0]-=t/2,z[0]+=t/2,$[1]-=i/2,z[1]+=i/2,B($,r,$,o),B(z,r,z,o),a?(a.xmin=$[0],a.ymin=$[1],a.xmax=z[0],a.ymax=z[1],a.spatialReference=o):a=new Ee($[0],$[1],z[0],z[1],o),a}const Nt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Zt,eyeForCenterWithHeadingTilt:Bt,eyeTiltToLookAtTilt:Jt,headingTiltToDirectionUp:hn,lookAtTiltToEyeTilt:Wt,toExtent:yn},Symbol.toStringTag,{value:"Module"})),wn=ye(0,0,1),xn=te(d(),ye(1,1,1)),Kt=new Ie(-180,180),V=Fe(),P=d(),k=d();function vn(e,n,t,i=mn()){L(P,e,wn),G(P,P)===0&&L(P,e,xn),it(V,-b(n),e),rt(V,V,-b(t),P);const{up:a,direction:r}=i;return L(a,P,e),te(a,a),ue(a,a,V),te(r,e),ot(r,r),ue(r,r,V),i}function Xt(e,n,t,i){const a=P,r=k;return te(a,e),L(k,a,wn),G(k,k)===0&&L(k,a,xn),L(r,k,a),dn(n,t,i,a,r)}function Yt(e,n,t,i){const a={eye:d(),up:null,tilt:i,heading:t},r=P;r[0]=e[0],r[1]=e[2],r[2]=-e[1];const o=n,s=b(t),c=b(i),l=Math.sin(s),u=Math.cos(s),g=Math.sin(c),f=Math.cos(c),y=_(r);let p;if(Math.abs(c)<1e-8)p=o+y;else{const Ke=y/g,Yn=De(o/Ke),Vn=Math.PI-c-Yn;p=Ke*Math.sin(Vn)}const S=f*o,C=o*o*(g*g),H=u*u*C,I=p-S,w=I*I,X=H*(H+w-r[1]*r[1]);if(X<0)return R(a.eye,r,p/y),a.tilt=0,oe(a,e);const Ze=Math.sqrt(X),Be=r[1]*I,We=H+w;let Je;if(Je=u>0?-Ze+Be:Ze+Be,Math.abs(We)<1e-8)return y<1e-8?(a.eye[0]=0,a.eye[1]=0,a.eye[2]=o):R(a.eye,r,p/y),a.tilt=0,Se(a.eye),oe(a,e);a.eye[1]=Je/We;const Kn=l*l*C,Re=g*o,Xn=u*Re*a.eye[1],Ne=a.eye[1]*a.eye[1],ie=1-Ne,be=Math.sqrt(ie),Te=H*Ne+Kn-2*Xn*be*I+ie*w;return Math.abs(Te)<1e-8?(R(a.eye,r,p/y),a.tilt=0,Se(a.eye),oe(a,e)):(a.eye[0]=(ie*(p*r[0]-S*r[0])-Re*be*(r[0]*a.eye[1]*u+r[2]*l))/Te,a.eye[2]=(ie*(p*r[2]-S*r[2])-Re*be*(r[2]*a.eye[1]*u-r[0]*l))/Te,R(a.eye,a.eye,p),Se(a.eye),oe(a,e))}function Se(e){const n=e[1];e[1]=-e[2],e[2]=n}function oe(e,n){const t=vn(n,e.heading,e.tilt);return e.up=t.up,e}function Vt(e,n,t){const i=_(n),a=Math.sqrt(t*t+i*i-2*t*i*Math.cos(Math.PI-e)),r=De(t/(a/Math.sin(e)));return E(e-r)}function Qt(e,n,t){const i=b(e),a=_(n);return De(t/(a/Math.sin(i)))+i}function Mn(e,n,t,i,a){let r,o,s,c;const l=n.latitude,u=Oe(e.spatialReference).radius,g=n.longitude,f=Ht(l,t,u)/2;r=g-f,o=g+f;const y=b(l),p=(1+Math.sin(y))/(1-Math.sin(y)),S=(p+1)*Math.tan(i/u/2),C=S*S;function H(w){const X=Math.PI/2;return(w=$t.normalize(w,-X))>X&&(w=Math.PI-w),w}if(s=1.5*Math.PI-2*Math.atan(.5*(S+Math.sqrt(4*p+C))),c=s+i/u,s=H(s),c=H(c),c<s){const w=c;c=s,s=w}if(s=Math.max(E(s),-90),c=Math.min(E(c),90),o=Kt.monotonic(r,o),o-r>180){const w=(o-r-180)/2;r+=w,o-=w}const I=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:J.WGS84;return a?(a.xmin=r,a.ymin=s,a.xmax=o,a.ymax=c,a.spatialReference=I):a=new Ee(r,s,o,c,I),e.spatialReference&&e.spatialReference.isWebMercator&&st(a,!1,a),a}const ea=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Xt,eyeForCenterWithHeadingTilt:Yt,eyeTiltToLookAtTilt:Qt,headingTiltToDirectionUp:vn,lookAtTiltToEyeTilt:Vt,toExtent:Mn},Symbol.toStringTag,{value:"Module"})),Rn=()=>ut.getLogger("esri.views.3d.support.cameraUtils"),bn=39.37,Tn=96,Ae=1,na=8,ta=5,Sn=1,tn=d(),aa={heading:0,tilt:0},ee=d(),ia=new Ie(-20037508342788905e-9,20037508342788905e-9),ra=new Ie(-180,180);var v;function D(e){return e.spatialReference??J.WGS84}function K(e){return e.viewingMode==="global"?ea:Nt}function ti(e,n,t,i,a){return K(e).headingTiltToDirectionUp(n,t,i,a)}function oa(e,n){if(n==null)return null;const t=e.renderSpatialReference,i=K(e).headingTiltToDirectionUp,a=d();if(!fe(n.position,a,t))return null;const r=i(a,n.heading,n.tilt);R(r.direction,r.direction,e.state.camera.distance),Z(r.direction,r.direction,a);const o=N(e,a,r.direction,r.up);return o.fov=b(n.fov),o.row=n.layout.row,o.rows=n.layout.rows,o.column=n.layout.column,o.columns=n.layout.columns,o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(v||(v={}));const q=d();function xe(e,n,t){const i=e.renderSpatialReference,a=Le(e,n.eye,n.viewForward,n.up,aa);let r=D(e);return B(n.eye,i,q,r)||(r=J.WGS84,B(n.eye,i,q,r)),t==null?t=new ne(new h(q,r),a.heading,a.tilt,E(n.fov)):(t.position.x=q[0],t.position.y=q[1],t.position.z=q[2],t.position.spatialReference=r,t.heading=a.heading,t.tilt=a.tilt,t.fov=E(n.fov)),t.layout.row=n.row,t.layout.rows=n.rows,t.layout.column=n.column,t.layout.columns=n.columns,t}function _e(e,n,t){const i=e.state.camera,a=i.width/2/i.pixelRatio;return e.renderCoordsHelper.viewingMode===Ue.Global&&t!=null&&(n*=Math.cos(b(t))),n/=e.renderCoordsHelper.unitInMeters,a/(Tn*bn/n)/Math.tan(i.fovX/2)}function W(e,n,t){const i=e.state.camera,a=n*Math.tan(i.fovX/2),r=i.width/2/i.pixelRatio;let o=Tn*bn/(r/a);return e.renderCoordsHelper.viewingMode===Ue.Global&&t!=null&&(o/=Math.cos(b(t))),o*e.renderCoordsHelper.unitInMeters}async function $n(e,n,t,i,a,r){return zn(e,n,_e(e,t,n.latitude),i,a,r)}function sa(e,n,t,i,a,r){return jn(e,Cn(e,i.heading,i.tilt,n,t,a),i.fov,r)}async function zn(e,n,t,i,a,r){const o=await An(e,i.heading,i.tilt,n,t,a,r);return T(r),kn(e,o,i.fov,r)}function Le(e,n,t,i,a){return K(e).directionToHeadingTilt(n,t,i,a)}function Gn(e,n){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(n,ee,e.spatialReference)&&e.elevationProvider&&(we(e.elevationProvider,ee)??0)>ee[2]-Sn)}async function ca(e,n,t){if(Gn(e,n))return!0;const{elevationProvider:i,spatialReference:a,renderCoordsHelper:r}=e;if(i==null||!r.fromRenderCoords(n,ee,a))return!1;const[o,s,c]=ee,l=await i.queryElevation(o,s,c,a,"ground",t)??0;return T(t),l>c-Sn}async function la(e,n,t){const i=d();if(n==null)return O(i,e.state.camera.center);if(n instanceof h){const{renderSpatialReference:a,basemapTerrain:r,elevationProvider:o}=e,s=n.spatialReference;if(await me(n,i,a,0,{signal:t}),T(t),n.z==null&&r!=null&&o!=null){const c=await o.queryElevation(n.x,n.y,n.z??0,s,"ground",t);T(t),c!=null&&e.renderCoordsHelper.setAltitude(i,c)}return i}return O(i,n)}function ua(e,n){const t=d();if(n==null)return O(t,e.state.camera.center);if(n instanceof h){if(!fe(n,t,e.renderSpatialReference))return null;const{basemapTerrain:i,elevationProvider:a}=e;if(n.z==null&&i!=null&&a!=null){const r=we(a,n);r!=null&&e.renderCoordsHelper.setAltitude(t,r)}return t}return O(t,n)}function Cn(e,n,t,i,a,r){return Pn(e,n,t,i instanceof h?i:null,ua(e,i),a,r)}async function An(e,n,t,i,a,r,o){const s=i instanceof h?i:null,c=await la(e,i,o);return T(o),On(e,n,t,s,c,a,r,o)}function Pn(e,n,t,i,a,r,o){if(a==null||!i&&(i=new h({spatialReference:D(e)}),!ae(a,e.renderSpatialReference,i)))return null;const s=En(e,n,t,a,r,o);if(Dn(e,t,o)&&Gn(e,s.eye)){const{tilt:c,mode:l}=Hn(e,t,a,r);return Pn(e,n,c,i,a,r,l)}return In(s,a)}async function On(e,n,t,i,a,r,o,s){i||(i=new h({spatialReference:D(e)}),await fn(a,e.renderSpatialReference,i,{signal:s})||(i=null)),T(s);const c=En(e,n,t,a,r,o);if(Dn(e,t,o)&&await ca(e,c.eye,s)){T(s);const{tilt:l,mode:u}=Hn(e,t,a,r);return On(e,n,l,i,a,r,u,s)}return In(c,a)}function En(e,n,t,i,a,r){const o=da(e,n,t,i,a=Math.max(a,e.state.constraints.minimumPoiDistance),r);return(0,K(e).eyeForCenterWithHeadingTilt)(i,a,o.heading,o.tilt)}function Dn(e,n,t){const i=e.map.ground.navigationConstraint;return t===v.ADJUST&&e.viewingMode==="global"&&n>0&&(i==null||i.type==="stay-above")}function Hn(e,n,t,i){const a=Ln(e,t,i,ga(e,i,n,t));return{tilt:a,mode:n-a<1?v.LOCKED:v.ADJUST}}function In(e,n){return{...e,center:ct(n)}}function Fn(e,n){const{state:t,spatialReference:i}=e,a=n.spatialReference;return t.isGlobal&&Ft(a,Ue.Global)||t.isLocal&&i.equals(a)}function Un(e,n){let t,i,a;if(e.state.isGlobal){const u=new h(n.xmin,n.ymin,n.spatialReference),g=new h(n.xmax,n.ymax,n.spatialReference),f=n.spatialReference.isGeographic?ra:ia;t=new h({x:f.center(u.x,g.x),y:(g.y+u.y)/2,z:n.zmax!=null&&n.zmin!=null?(n.zmax+n.zmin)/2:void 0,spatialReference:n.spatialReference});const y=Oe(n.spatialReference),p=It(t,u,g);i=p.lon,a=p.lat,f.diff(u.x,g.x)>f.range/2&&(i+=y.halfCircumference),i=Math.min(i,y.halfCircumference),a=Math.min(a,y.halfCircumference)}else{const u=e.renderSpatialReference??n.spatialReference;u.equals(n.spatialReference)||(n=on(n,u)),i=n.xmax-n.xmin,a=n.ymax-n.ymin;const g=n.zmax!=null&&n.zmin!=null?(n.zmax+n.zmin)/2:void 0;t=new h({x:n.xmin+.5*i,y:n.ymin+.5*a,z:g,spatialReference:u})}const r=n.zmax!=null&&n.zmin!=null?n.zmax-n.zmin:0,o=e.state.camera,s=1/Math.tan(o.fovX/2),c=1/Math.tan(o.fovY/2),l=1/Math.tan(o.fov/2);return{center:t,distance:Math.max(.5*i*s,.5*a*c,.5*r*l)/Ae}}async function _n(e,n,t,i,a,r){const o=Fn(e,n)?n:await j(n,e.spatialReference,{signal:r});T(r);const{center:s,distance:c}=Un(e,o),l=await An(e,t,i,s,c,a,r);return T(r),kn(e,l,e.camera.fov,r)}function fa(e,n,t,i,a,r){let o;try{o=Fn(e,n)?n:on(n,e.spatialReference)}catch{return null}const{center:s,distance:c}=Un(e,o),l=Cn(e,t,i,s,c,a);return l==null?null:jn(e,l,e.camera.fov,r)}function ai(e,n,t){const i=e.renderSpatialReference,a=new h({spatialReference:D(e)});if(!ae(t,i,a))return null;const r=Math.tan(n.fovX/2),o=Math.tan(n.fovY/2),s=lt(n.eye,t),c=2*s*r*Ae,l=2*s*o*Ae;return e.viewingMode==="global"?Mn(e,a,c,l):yn(e,a,c,l)}function ma(e,n,t){const i=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(t/i)/Math.LN2>na)return!0;const a=n,r=e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;return He(a,r)/(Math.tan(.5*e.state.camera.fov)*i)>ta}function da(e,n,t,i,a,r){let o=0;return r===v.ADJUST&&ma(e,i,a)?(n=0,o=pa(e,a,t,i)):o=je(e,i,a,t),o=e.state.constraints.clampTilt(a,o),{heading:n,tilt:t=Ln(e,i,a,o)}}const pe=.7;function pa(e,n,t,i){const a=je(e,i,n,t);if(!e.state.constraints.tilt)return a;const r=e.state.constraints.tilt(n);r.max=Math.min(r.max,.5*Math.PI);const o=r.min*(1-pe)+r.max*pe;return Math.min(a,o)}function ga(e,n,t,i){let a=je(e,i,n,t);if(!e.state.constraints.tilt)return a;const r=e.state.constraints.tilt(n);return a=Math.min(a,.5*Math.PI),r.min*(1-pe)+a*pe}function Ln(e,n,t,i){return K(e).lookAtTiltToEyeTilt(i,n,t)}function je(e,n,t,i){return K(e).eyeTiltToLookAtTilt(i,n,t)}function jn(e,n,t,i){if(n==null)return null;const a=e.renderSpatialReference,r=new h({spatialReference:D(e)});return ae(n.eye,a,r)?(i??(i=new ne),i.position=r,i.heading=n.heading,i.tilt=n.tilt,i.fov=t,i):null}async function kn(e,n,t,i){const a=e.renderSpatialReference,r=new h({spatialReference:D(e)});return await fn(n.eye,a,r,{signal:i}),T(i),new ne(r,n.heading,n.tilt,t)}function ii(e,n){var i;const t=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(t)return t.levelAtScale(n);Rn().error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function ha(e,n){var i;const t=(i=e.basemapTerrain)==null?void 0:i.tilingScheme;if(t)return t.scaleAtLevel(n);Rn().error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function qn(e,n){const{renderSpatialReference:t}=e,i=Ut(t);let a=null;try{B(n.center,t,tn,i)&&(a=tn[1])}catch{}return W(e,n.distance,a)}const ya=.66;function Zn(e){return 360-un.normalize(e)}function ve(e){return un.normalize(360-e)}function wa(e,n,t){const i=n.camera;if(i!=null)return xa(i,D(e));const{targetGeometry:a}=n;if(a==null)return null;const{camera:r,mode:o}=Wn(e,n.rotation,t);if(a.type==="point")return Ma(e,n,a,r,o);const s=a.extent;return s==null?null:fa(e,s,r.heading,r.tilt,o)}async function Bn(e,n,t,i){const a=n.camera;if(a!=null)return va(a,D(e),i);const{targetGeometry:r}=n;if(r==null)throw new Error("Viewpoint has no targetGeometry!");const{camera:o,mode:s}=Wn(e,n.rotation,t);if(r.type==="point")return Ra(e,n,r,o,s,i);const c=r.extent;if(c==null)throw new Error("Target geometry has no extent!");return _n(e,c,o.heading,o.tilt,s,i)}function xa(e,n){const t=e.position;let i;try{i=sn(t,n)}catch{return null}if(!i)return null;const a=e.clone();return a.position=i.clone(),a}async function va(e,n,t){const i=e.position,a=await j(i,n,{signal:t});T(t);const r=e.clone();return r.position=a.clone(),r}function Wn(e,n,t){const i=xe(e,e.state.camera);let a=v.ADJUST;return n!=null&&(i.heading=Zn(n),a=v.LOCKED),t!=null&&(i.tilt=t),{camera:i,mode:a}}function Ma(e,n,t,i,a){const r=e.spatialReference;let o;try{o=sn(t.clone(),r)}catch{return null}if(!o)return null;const s=n.scale!=null?_e(e,n.scale,o.latitude):e.state.camera.distance;return sa(e,o,s,i,a)}async function Ra(e,n,t,i,a,r){const o=e.spatialReference,s=await j(t.clone(),o,{signal:r});T(r);const c=n.scale!=null?_e(e,n.scale,s.latitude):e.state.camera.distance;return zn(e,s,c,i,a,r)}function ba(e,n,t=null){return t==null&&(t=new Ge),qe(e,null,n.clone(),t)}async function Ta(e,n,t){const i=Da(e,n);if(!i)throw new cn("viewpointutils-create:no-target","Missing target for creating viewpoint");const a=new ne({fov:e.camera.fov}),r=new Ge({camera:a});if(i.target instanceof Ge)return U(await za(e,i.target,i,t,r));if(i.target instanceof ne)return U(await Nn(e,i.target,t,r));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof Ee){const l=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return U(o||l?await Pe(e,i,i.target.center,a,t,r):await Pa(e,i,i.target,a,t,r))}const s=new Ia,c=o?Sa(e,i):void 0;if(await Jn(e,i.target,c,s,t),isFinite(s.boundingBox[0])){let l;if(dt(s.boundingBox,m),M.x=m[0],M.y=m[1],M.z=m[2],M.spatialReference=e.spatialReference,isFinite(M.z)&&s.hasZ?l=pt(s.boundingBox):(M.z=void 0,l=gt(ht(s.boundingBox,Fa))),o||l)return U(await Pe(e,i,M,a,t,r));const u=Ha(e,s.screenSpaceObjects);return U(await Ea(e,i,M,s.boundingBox,u,a,t,r))}return i.position?U(await Ca(e,i,a,r,t)):U(await Aa(e,i,a,t,r))}function ke(e,n){return n.scale==null&&n.zoom!=null?ha(e,n.zoom):n.scale}function Sa(e,n){const t=ke(e,n);return t?yt(t):void 0}function Me(e,n){let t=!1;return n.heading!=null?(e.heading=n.heading,t=!0):n.rotation!=null&&(e.heading=Zn(n.rotation),t=!0),n.tilt!=null&&(e.tilt=n.tilt,t=!0),n.fov!=null&&(e.fov=n.fov),t}function qe(e,n,t,i){const a=e.spatialReference||J.WGS84;if(n??(n=oa(e,t)),n==null)return i;const r=new h({spatialReference:a});if(!ae(n.center,e.renderSpatialReference,r))return i;i.targetGeometry=r;const{latitude:o}=r;return i.scale=o!=null?W(e,n.distance,o):qn(e,n),i.rotation=ve(t.heading),i.camera=t,i}async function ge(e,n,t,i){var g;const a=()=>new cn("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!n)throw a();n.type==="mesh"&&(n=n.extent);const r=e.basemapTerrain.spatialReference;if(!n.hasZ&&e.basemapTerrain){let f;switch(n.type){case"point":f=n;break;case"multipoint":case"polyline":f=(g=n.extent)==null?void 0:g.center;break;case"extent":f=n.center;break;case"polygon":f=n.centroid}f!=null&&r&&e.elevationProvider?(f=await j(f,r,{signal:i}),m[2]=we(e.elevationProvider,f)??0):m[2]=0}const o=Ua[n.type],s=new Array;if(o(n,n.hasZ?f=>{s.push([f[0],f[1],f[2]])}:f=>{s.push([f[0],f[1]])},m),s.length===0)throw a();const c=n.spatialReference,l=e.spatialReference,u=await j(new vt({spatialReference:c,hasZ:n.hasZ,hasM:!1,points:s}),l,{signal:i});if(n.hasZ&&(t.hasZ=!0),n.hasZ)for(const[f,y,p]of u.points)m[0]=f,m[1]=y,m[2]=p,Ce(t.boundingBox,m);else for(const[f,y]of u.points)m[0]=f,m[1]=y,Ce(t.boundingBox,m)}async function $a(e,n,t,i,a){const r=await Qe(e.whenViewForGraphic(n));if(r.ok===!1||r.value==null||!("whenGraphicBounds"in r.value))return void await ge(e,n.geometry,i,a);const o=r.value,s=await Qe(o.whenGraphicBounds(n,{minDemResolution:t}));if(s.ok===!1||!s.value)return void await ge(e,n.geometry,i,a);const{screenSpaceObjects:c,boundingBox:l}=s.value;Mt(i.boundingBox,l),c&&c.forEach(u=>{i.screenSpaceObjects.push(u)}),isFinite(l[2])&&(i.hasZ=!0)}async function Jn(e,n,t,i,a){var r;if(Array.isArray(n)&&n.length===2){const o=n[0],s=n[1];if(typeof o=="number"&&typeof s=="number")return M.x=o,M.y=s,M.z=void 0,M.spatialReference=(r=e.spatialReference)!=null&&r.isGeographic?e.spatialReference:J.WGS84,void await ge(e,M,i,a)}n&&"map"in n&&typeof n.map=="function"?await Promise.allSettled(n.map(o=>Jn(e,o,t,i,a))):n instanceof wt?await ge(e,n,i,a):n instanceof xt&&await $a(e,n,t,i,a)}async function za(e,n,t,i,a){if(n.camera)return Nn(e,n.camera,i,a);a.scale=n.scale,a.rotation=n.rotation,a.targetGeometry=n.targetGeometry!=null?n.targetGeometry.clone():null,a.camera=null,t.heading!=null?a.rotation=ve(t.heading):t.rotation!=null&&(a.rotation=t.rotation);const r=ke(e,t);return r!=null&&(a.scale=r),a.camera=await Bn(e,a,t.tilt,i),a}async function Nn(e,n,t,i){const a=e.spatialReference,r=await j(n.position,a,{signal:t}),o=n.clone();return o.position=r,qe(e,null,o,i)}async function Ga(e,n,t,i,a,r,o){const s=e.renderSpatialReference;return await me(n,$e,s,0,{signal:o}),await me(t,ce,s,0,{signal:o}),r.targetGeometry=new h(n),a.position=new h(t),le(he,$e,ce),Le(e,ce,he,i.up,a),r.scale=W(e,He(ce,$e),r.targetGeometry.latitude),r.rotation=ve(a.heading),r.camera=a,r}async function Pe(e,n,t,i,a,r){r.targetGeometry=t.clone();const o=N(e);if(n.position)return Ga(e,r.targetGeometry,n.position,o,i,r,a);if(n.zoomFactor){const c=o.distance/n.zoomFactor,l=R(m,o.viewForward,-c);o.eye=Z(m,o.center,l),r.scale=W(e,c,t.latitude)}xe(e,o,i);const s=Me(i,n)?v.LOCKED:v.ADJUST;if(!n.zoomFactor){const c=ke(e,n);c==null?(await me(t,m,e.renderSpatialReference,0,{signal:a}),Pt(o.frustum,m)?r.scale=W(e,He(o.eye,m),t.latitude):r.scale=qn(e,o)):r.scale=c,r.camera=await $n(e,r.targetGeometry,r.scale,i,s,a)}return r}async function Ca(e,n,t,i,a){const r=N(e);O(he,r.viewForward),Le(e,r.eye,he,r.up,ze);const o=e.spatialReference,{position:s}=n;if(s){const c=await j(s,o,{signal:a});t.position=c}else t.position=new h;return t.heading=n.heading!=null?n.heading:ze.heading,t.tilt=n.tilt!=null?n.tilt:ze.tilt,qe(e,null,t,i)}async function Aa(e,n,t,i,a){if(n.heading!=null||n.rotation!=null||n.scale!=null||n.tilt!=null||n.zoom!=null||n.zoomFactor!=null){const r=N(e),{spatialReference:o,renderSpatialReference:s}=e,c=new h({spatialReference:o});return ae(r.center,s,c)?Pe(e,n,c,t,i,a):a}return a.scale=e.scale,a.camera=e.camera.clone(),Me(a.camera,n),a}async function Pa(e,n,t,i,a,r){r.targetGeometry=t.clone();const o=N(e);xe(e,o,i);const s=Me(i,n)?v.LOCKED:v.ADJUST;return r.camera=await _n(e,t,i.heading,i.tilt,s,a),r}function Oa(e,n,t,i,a){let r=0;t.z!=null?r=t.z:e.basemapTerrain&&e.elevationProvider&&(r=we(e.elevationProvider,t)),x(m,t.x,t.y,r),At(e.spatialReference,m,an,e.renderSpatialReference),zt(se,an),Gt(se,se),ln(Q);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let p=0;p<o.length;p++){const S=o[p];let C=i[S[2]];isFinite(C)||(C=r),x(m,i[S[0]],i[S[1]],C),B(m,e.spatialReference,m,e.renderSpatialReference),Ce(Q,Rt(m,m,se))}const s=bt(Q),c=Tt(Q),l=St(Q),u=1/Math.tan(n.fovX/2),g=1/Math.tan(n.fovY/2),f=.5*Math.sqrt(s*s+l*l)*Math.max(g,u)+.5*c,y=.5*c*g+.5*Math.max(s,l);return Math.max(f,y)/a}async function Ea(e,n,t,i,a,r,o,s){s.targetGeometry=t.clone();const c=N(e),l=Oa(e,c,t,i,a);xe(e,c,r);const u=Me(r,n)?v.LOCKED:v.ADJUST;return s.scale=W(e,l,s.targetGeometry.latitude),s.camera=await $n(e,s.targetGeometry,s.scale,r,u,o),s}function Da(e,n){if(!n||!e.spatialReference)return null;const t={target:void 0};return"declaredClass"in n||Array.isArray(n)?t.target=n:(Object.assign(t,n),!t.target&&"center"in n&&n.center&&(t.target=n.center)),t}function U(e){return(e==null?void 0:e.camera)!=null&&(e.rotation=ve(e.camera.heading)),e}function Ha(e,n){const t=ya;if(!n.length)return t;let i=Number.NEGATIVE_INFINITY;for(let a=0;a<n.length;a++){const r=n[a].screenSpaceBoundingRect;i=Math.max(i,Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2]),Math.abs(r[3]))}return t-i/Math.min(e.width,e.height)*2}class Ia{constructor(){this.hasZ=!1,this.boundingBox=ln(),this.screenSpaceObjects=new Array}}const m=d(),an=Fe(),se=Ct(),Q=ft(),Fa=mt(),he=d(),ce=d(),$e=d(),ze={heading:0,tilt:0},M=new h,Ua={point(e,n,t){t[0]=e.x,t[1]=e.y,e.z!=null&&(t[2]=e.z),n(t)},polygon(e,n,t){const i=e.hasZ;for(let a=0;a<e.rings.length;a++){const r=e.rings[a];for(let o=0;o<r.length;o++)t[0]=r[o][0],t[1]=r[o][1],i&&(t[2]=r[o][2]),n(t)}},polyline(e,n,t){const i=e.hasZ;for(let a=0;a<e.paths.length;a++){const r=e.paths[a];for(let o=0;o<r.length;o++)t[0]=r[o][0],t[1]=r[o][1],i&&(t[2]=r[o][2]),n(t)}},multipoint(e,n,t){const i=e.points,a=e.hasZ;for(let r=0;r<i.length;r++)t[0]=i[r][0],t[1]=i[r][1],a&&(t[2]=i[r][2]),n(t)},extent(e,n,t){e.zmin!=null&&e.zmax!=null?(n(x(t,e.xmin,e.ymin,e.zmin)),n(x(t,e.xmax,e.ymin,e.zmin)),n(x(t,e.xmin,e.ymax,e.zmin)),n(x(t,e.xmax,e.ymax,e.zmin)),n(x(t,e.xmin,e.ymin,e.zmax)),n(x(t,e.xmax,e.ymin,e.zmax)),n(x(t,e.xmin,e.ymax,e.zmax)),n(x(t,e.xmax,e.ymax,e.zmax))):(n(x(t,e.xmin,e.ymin,t[2])),n(x(t,e.xmax,e.ymin,t[2])),n(x(t,e.xmin,e.ymax,t[2])),n(x(t,e.xmax,e.ymax,t[2])))}},ri=Object.freeze(Object.defineProperty({__proto__:null,create:Ta,fromCamera:ba,toCameraAsync:Bn,toCameraSync:wa},Symbol.toStringTag,{value:"Module"}));export{_e as $,ha as A,v as K,ti as N,ii as P,xe as Q,ai as R,oa as Z,W as _,ni as a,Cn as c,Ta as d,_t as f,N as g,ba as h,wa as l,Le as r,mn as u,ri as v,fa as w};
