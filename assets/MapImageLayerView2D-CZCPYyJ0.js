import{br as n,G as g,o as d,j as a,y as h,P as l}from"./index-Dv-JqQDv.js";import{c as u}from"./GraphicsCollection-DlcRCtU0.js";import{a as c}from"./BitmapContainer-D7hi0L29.js";import{f}from"./LayerView2D-Ulqog2NM.js";import{V as y}from"./GraphicsView2D-C4K17d-1.js";import{h as _}from"./HighlightGraphicContainer-rrird331.js";import{_ as H}from"./ExportStrategy-MueE7KUE.js";import{y as w}from"./LayerView-6INZgiuX.js";import{i as $}from"./MapImageLayerView-BumSfhX1.js";import{i as v}from"./RefreshableLayerView-BkpnzSC-.js";import{_ as x}from"./MapServiceLayerViewHelper-P5_-d7K2.js";import{r as U}from"./drapedUtils-nWPHxHp9.js";import"./WGLContainer-m5Dqdi-d.js";import"./definitions-ByNBSgP9.js";import"./LabelMetric-CSrxjJk_.js";import"./enums-BRXbslMp.js";import"./Texture-BsiXXqc8.js";import"./enums-BlUEVwJR.js";import"./Program-By3cM00b.js";import"./BufferObject-Dhco7AlX.js";import"./_commonjsHelpers-DCkdB7M8.js";import"./VertexElementDescriptor-BOD-G50G.js";import"./BoundingBox-BhuXqU4L.js";import"./vec2f32-BbH2jxlN.js";import"./VertexArrayObject-Czm05pt7.js";import"./WGLBrushVTLSymbol-Hhd0CFGx.js";import"./DefaultUI-BWAdHYa0.js";import"./jsxFactory-C3RLkrq9.js";import"./UpdatingHandles-C0Kh7aEt.js";import"./InputManager-BwD1PEf3.js";import"./signal-0tlktF45.js";import"./Map-DV4_DU8O.js";import"./Ground-DpNOewuO.js";import"./CollectionFlattener-73Uag1LF.js";import"./editableLayers-V9yr_aA-.js";import"./catalogUtils-CiWgGrdS.js";import"./TablesMixin-BFT6ikAR.js";import"./ReactiveMap-DxvIcNmk.js";import"./selectionUtils-DYi6daQO.js";import"./IViewEvents-Bci6PjlS.js";import"./interfaces-D6pIddIh.js";import"./screenUtils-DKZWDFXK.js";import"./a11yUtils-DW8v-NB5.js";import"./heightModelInfoUtils-DQiO1_HQ.js";import"./ViewingMode-Dodu7ZZk.js";import"./capabilities-C84AMSCg.js";import"./themeUtils-C3zvZbsE.js";import"./globalCss-CZa70j6i.js";import"./accessibleHandler-CEs_6QlQ.js";import"./Compass-DBSyeZOs.js";import"./utils-DsJqvptN.js";import"./GoTo-BCG1WN4R.js";import"./NavigationToggle-CRz1xlJz.js";import"./Zoom-C6srvgaZ.js";import"./vec4f32-CjrfB-0a.js";import"./StyleDefinition-BK3ROBTO.js";import"./config-MDUrh2eL.js";import"./ShaderCompiler-G2XYGDs6.js";import"./ProgramTemplate-DUy4DuxJ.js";import"./DefaultVertexAttributeLayouts-BaFfZuup.js";import"./mat3-B7LiNcRs.js";import"./DisplayObject-NwP1D55U.js";import"./TileKey-DixmkgbB.js";import"./mat2df32-orApM5a3.js";import"./mat2d-C6u6dH6d.js";import"./vec3f32-Cw9Q6TO_.js";import"./Container-BCZInv5n.js";import"./EffectView-D358IIvW.js";import"./highlightReasons-Bl95o-z6.js";import"./Tile-BD3hIcqg.js";import"./quickselect-D0_cvEX6.js";import"./earcut-BqgeR2O3.js";import"./vec2-DGogPjh1.js";import"./vec2f64-Diu2Kaa8.js";import"./MapView-BeVtHZG4.js";import"./Viewpoint-kowK2Ox4.js";import"./Cyclical-L5YKfO29.js";import"./TileInfo-Dsgw3bLM.js";import"./TileKey-DZd6gJy7.js";import"./viewpointUtils-CBa44EU3.js";import"./mat2df64-CBKYtunK.js";import"./unitBezier-BX6NeAEr.js";import"./TileStrategy-Bm9AEGL5.js";import"./QueueProcessor-DHxW4yaI.js";import"./utils-CXgSw6Sd.js";import"./ColorBackground-DO2jUIHL.js";import"./ClipRect-C_x5PYDD.js";import"./layerViewUtils-D2JqIDZ8.js";import"./CIMSymbolHelper-DBCkPMeB.js";import"./BidiEngine-BwB1Df7c.js";import"./fontUtils-CnE29zYd.js";import"./GeometryUtils-CGcKgdcH.js";import"./Rect-CUzevAry.js";import"./AttributeStore-Ci4QkEXR.js";import"./UpdateTracking2D-DLChT46s.js";import"./BindType-BmZEZMMh.js";import"./Util-CQaYQWOS.js";import"./labelFormatUtils-Dqk4IbyQ.js";import"./TimeOnly-DM31kLsz.js";import"./centroid-DdLmOD72.js";import"./timeSupport-DgYx0Uxy.js";import"./json-Wa8cmqdu.js";import"./FeatureCommandQueue-D3L0Wlvg.js";import"./heatmapTextureUtils-Y8Y_7g3k.js";import"./constants-D5zmR9t2.js";import"./normalizeUtilsSync-B3yip2wp.js";import"./AGraphicContainer-BCFkzrhS.js";import"./TechniqueInstance-C2g9Xtfa.js";import"./TileContainer-DO1c6A5U.js";import"./Bitmap-B9B0VE0s.js";import"./ExportImageParameters-D7_18ylM.js";import"./floorFilterUtils-DZ5C6FQv.js";import"./sublayerUtils-CPuB3ran.js";import"./timeSupport-CVYAdt33.js";import"./timeUtils-DFs82Cpv.js";import"./tagSymbols-BPcGfZon.js";import"./popupUtils-CSsimScH.js";let e=class extends $(v(f(w))){constructor(){super(...arguments),this._highlightGraphics=new u,this._updateHash=""}fetchPopupFeaturesAtLocation(t,i){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,i)}update(t){const i=`${this.exportImageVersion}/${t.state.id}/${t.pixelRatio}/${t.stationary}`;this._updateHash!==i&&(this._updateHash=i,this.strategy.update(t).catch(r=>{n(r)||g.getLogger(this).error(r)}),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){const{imageMaxWidth:t,imageMaxHeight:i,version:r}=this.layer,p=r>=10.3,s=r>=10;this._bitmapContainer=new c,this.container.addChild(this._bitmapContainer),this._highlightView=new y({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new _(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new x({createFetchPopupFeaturesQueryGeometry:(o,m)=>U(o,m,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(o,m)=>{this._highlightView.graphicUpdateHandler({graphic:o,property:m})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new H({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:i,imageRotationSupported:p,imageNormalizationSupported:s,hidpi:!0}),this.addAttachHandles(d(()=>this.exportImageVersion,()=>this.requestUpdate())),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,i,r,p){return this.layer.fetchImage(t,i,r,{timeExtent:this.timeExtent,floors:this.floors,...p})}fetchImageBitmap(t,i,r,p){return this.layer.fetchImageBitmap(t,i,r,{timeExtent:this.timeExtent,floors:this.floors,...p})}highlight(t){return this._popupHighlightHelper.highlight(t)}};a([h()],e.prototype,"strategy",void 0),a([h()],e.prototype,"updating",void 0),e=a([l("esri.views.2d.layers.MapImageLayerView2D")],e);const Ai=e;export{Ai as default};
